#####################################
######## L.Point - ìƒì–´ì´ˆë°¥ #########
#####################################

#1. Word2Vec í•™ìŠµ
#2. ê³ ê°ë³„ ë¬¼í’ˆ ì¶”ì²œ ì¢Œí‘œê³„ & ë¬¼í’ˆ ì¶”ì²œ
#3. í•™ìŠµí•œ Word2Vec ì‹œê°í™”


################################################################################
################################################################################

##### Word2Vec í•™ìŠµ #####

#ë¨¼ì € íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤
install.packages("devtools")
library(devtools) #wordVectorsë¼ëŠ” íŒ¨í‚¤ì§€ëŠ” ê¹ƒí—ˆë¸Œì—ì„œ ì§ì ‘ ë‹¤ìš´ë°›ì•„ ì™€ì•¼í•˜ê¸° ë•Œë¬¸ì— 'devtools'íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë°›ìŠµë‹ˆë‹¤.

install_github("bmschmidt/wordVectors") #Word2Vec ìš© íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤ .
library(wordVectors)

load("data_win_word2vec.Rdata") 
#í•™ìŠµì‹œí‚¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
#ë³€ìˆ˜ëª… word2vec

write(Word2Vec,"Word2Vec.txt") 
#word2vec ë°ì´í„°ë¥¼ ì›Œë“œíˆ¬ë²¡ì— í•™ìŠµì‹œí‚¤ê¸° ìœ„ì— txtíŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.


#Word2Vecì„ 20ì°¨ì›ìœ¼ë¡œ í•™ìŠµì‹œí‚µë‹ˆë‹¤.
#vectors = 20 : 20ì°¨ì›, window = 8 : ê¸°ì¤€ ë‹¨ì–´ ì•,ë’¤ë¡œ 8ê°œì”© í™•ì¸
model = train_word2vec("Word2Vec.txt",output="Word2Vec20.bin",threads = 3,vectors = 20,window=8)
# model<-read.vectors("Word2Vec20.bin") #í•œë²ˆ ë§Œë“  ëª¨ë¸ì€ read.vectors í•¨ìˆ˜ë¡œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


set.seed(1) #ì”¨ë“œë„˜ë²„ë¥¼ ì£¼ì–´ì„œ í•­ìƒ ê°™ì€ ê·¸ë˜í”„ê°€ ê·¸ë ¤ì§€ë„ë¡ í–ˆìŠµë‹ˆë‹¤.
plot(model)

nearest_to(model,model[[c("C160406")]],10) #C160406ëŠ” ìœ ì•„ìš©ê¸°ì €ê·€ ì…ë‹ˆë‹¤.
#ìœ ì•„ìš© ê¸°ì €ê¸°ì™€ ê°€ê¹Œìš´ ë¬¼í’ˆ 10ê°€ì§€ë¥¼ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

## ê²°ê³¼ë¬¼ë“¤ì´ ì½”ë“œëª…ì´ë¼ í•´ì„í•˜ê¸° ì–´ë ¤ìš´ í˜•íƒœë¡œ ë‚˜ì™”ìŠµë‹ˆë‹¤.

#############################################################################################################
#############################################################################################################
##                                                                                                         ##
## C160406      C130401      C160407      C160206      C160409      C150509      C170305      C130403      ##
## 2.220446e-16 3.149391e-02 4.159744e-02 4.937160e-02 5.762460e-02 5.970940e-02 6.450369e-02 6.650422e-02 ##  
## C160404      C170159                                                                                    ##
## 6.733528e-02 6.820762e-02                                                                               ##
##                                                                                                         ##
#############################################################################################################
#############################################################################################################

#ì†Œë¶„ë¥˜ì½”ë“œëª…ì„ ì†Œë¶„ë¥˜ëª…ìœ¼ë¡œ ë°”ê¾¸ì–´ì£¼ì–´ í•´ì„ì— ìš©ì´í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
clasfic<-read.table("ì œ3íšŒ Big Data Competition-ë¶„ì„ìš©ë°ì´í„°-03.ìƒí’ˆë¶„ë¥˜.txt",sep=",",header=T,stringsAsFactors=F)

clasfic<-clasfic[,c("ì†Œë¶„ë¥˜ì½”ë“œ","ì†Œë¶„ë¥˜ëª…")]
#'ì†Œë¶„ë¥˜ì½”ë“œ' ì™€ 'ì†Œë¶„ë¥˜ëª…'ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

name<-function(x){
  index=which(clasfic[,1]%in%names(nearest_to(model,model[[c(x)]]))) 
  y<-nearest_to(model,model[[c(x)]])#xìœ„ì¹˜ì— ì†Œë¶„ë¥˜ëª…ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ ì†Œë¶„ë¥˜ì½”ë“œì™€ ì¼ì¹˜í•˜ëŠ” ì´ë¦„ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
  names(y)<-clasfic[index,2]
  return(y)
}
name("C160406") #ìœ ì•„ìš©ê¸°ì €ê·€ì™€ ì½”ì‚¬ì¸ ê±°ë¦¬ê°€ ê°€ê¹Œìš´ ìˆœìœ¼ë¡œ ë‚˜ì—´í•œ ê²°ê³¼ì…ë‹ˆë‹¤.

#######################################################################################################
#######################################################################################################
##                                                                                                   ##
##  ë¶„ìœ             ìœ ì•„ê³¼ì        í† ì´ìº”ë””        ìœ ì•„ìš©ë¬¼í‹°ìŠˆ    ìœ ì•„/ì•„ë™ìš©ì¹«ì†”    ìœ ì•„ìš©ê¸°ì €ê·€  ##
##  2.220446e-16    3.149391e-02    4.159744e-02    4.937160e-02    5.762460e-02        5.970940e-02 ##
##  ìœ ì•„ìš©ì„¸ì²™ìš©í’ˆ  ì –ë³‘/ì –ê¼­ì§€     ì¢…ì´ì»µ     ê±´ì „ì§€                                                ##
##  6.450369e-02    6.650422e-02    6.733528e-02    6.820762e-02                                     ##
##                                                                                                   ##
#######################################################################################################
#######################################################################################################




################################################################################
################################################################################

##### ê³ ê°ë³„ ë¬¼í’ˆ ì¶”ì²œ ì¢Œí‘œê³„ & ë¬¼í’ˆ ì¶”ì²œ #####

#ê° ìœ ì €ê°€ êµ¬ë§¤í•œ ë¬¼í’ˆì„ ì ìˆ˜ ìˆœìœ¼ë¡œ Xì¶•ì— ë‚˜ì—´í•˜ê¸° ìœ„í•´ "ê³ ê°ë³„ ë¬¼í’ˆ ì ìˆ˜ í–‰ë ¬" ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
load("win_data_TFmat.Rdata")


#"ì¤‘ìš”ë„"ë¥¼ ë‚˜íƒ€ë‚´ëŠ” Zì¶•ì„ ìƒì„±í•©ë‹ˆë‹¤.
TFlist<-names(sort(apply(win_data_TFmat,2,sum),decreasing=T)) 

TFlist[1] #1ë“±ì€ ì¼ë°˜í°ìš°ìœ ê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤.


#ê³ ê°ë²ˆí˜¸ ì™€ ì†Œë¶„ë¥˜ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
index<-rownames(win_data_TFmat)
item_index<-colnames(win_data_TFmat)


#êµ¬ë§¤í•œ ë¬¼ê±´ê°¯ìˆ˜ì˜ ì œê³±ê·¼ ë§Œí¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
#iê°œë¥¼ iì˜ ì œê³±ê·¼(ê°œ)í±–ë¡œ ì¤„ì—¬ ì¶”ì²œì¢Œí‘œê³„ì—ì„œ ë¶ˆí•„ìš”í•œ ì¢Œí‘œë¥¼ ì¤„ì…ë‹ˆë‹¤.

load("data_win_ì§ê¶2.Rdata") 
#"êµ¬ë§¤ëª©ë¡ ë°ì´í„°"ë¥¼ ë§Œë“¤ ë•Œ ê³ ê°ë³„ ì´ êµ¬ë§¤íšŸìˆ˜ë¥¼ ì €ì¥í•´ë‘ì—ˆë˜ Rdataì…ë‹ˆë‹¤.


n=5 #Yì¶•ì— ë‚˜ì—´í•  ìœ ì‚¬í•œ ë¬¼í’ˆì˜ ìˆ˜ë¥¼ 5ê°œë¡œ ì§€ì •í•©ë‹ˆë‹¤.

##ìµœì¢…ì ìœ¼ë¡œ ì¶”ì²œí•  ì„¸ê°€ì§€ë¥¼ final_recommend_word2vecì— ì €ì¥í•©ë‹ˆë‹¤.
final_recommend_word2vec <- matrix(NA,nrow=length(index),ncol=3)

for(i in 1:length(index)){
  recomlist<-sort(win_data_TFmat[i,],decreasing = T)[1:sqrt(x[i])] 
  #recomlist ì—ì„œ ì°¨ë¡€ëŒ€ë¡œ n(5)ê°œì”© ì¶”ì²œ
  
  csim<-matrix(0,ncol=n,nrow=length(recomlist)) #ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ ì €ì¥í•  ê³µê°„ì…ë‹ˆë‹¤.
  csim_name<-matrix(0,ncol=n,nrow=length(recomlist)) #ì†Œë¶„ë¥˜ì½”ë“œë¥¼ ì €ì¥í•  ê³µê°„ì…ë‹ˆë‹¤.
  
  for(j in 1:length(recomlist)){
    csim[j,]<-nearest_to(model,model[[names(recomlist[j])]])[2:(n+1)] 
    #jë²ˆì§¸ ë¬¼ê±´ê³¼ ê°€ì¥ ìœ ì‚¬í•œ 5ê°€ì§€ ë¬¼í’ˆì˜ ê±°ë¦¬ë¥¼ csimì— ì €ì¥í•©ë‹ˆë‹¤.
    
    csim_name[j,]<-names(nearest_to(model,model[[names(recomlist[j])]])[2:(n+1)])
    #jë²ˆì§¸ ë¬¼ê±´ê³¼ ê°€ì¥ ìœ ì‚¬í•œ 5ê°€ì§€ ë¬¼í’ˆì˜ ì†Œë¶„ë¥˜ ì½”ë“œë¥¼ csim_nameì— ì €ì¥í•©ë‹ˆë‹¤.
  } 
  
  TFlist_each<-which(TFlist%in%names(recomlist)) 
  #ë‚˜ì—´í•œ ë£¨íŠ¸(x[i])ê°œ(- xì¶•) ì˜ ì¤‘ìš”ë„ë¥¼ ë¹„êµí•˜ì—¬ zì¶•ì— ë‚˜ì—´í•©ë‹ˆë‹¤.  
  
  scale_pro<-vector("numeric",length(TFlist_each))
  #5ì  ë§Œì ìœ¼ë¡œ TF-IDF ì ìˆ˜ë¥¼ í™˜ì‚°í•˜ê³  ì €ì¥í•  ê³µê°„ì…ë‹ˆë‹¤.
  
  for(k in 1:length(scale_pro)){
    scale_pro[k] <-5*(TFlist_each[k]-min(TFlist_each))/(max(TFlist_each)-min(TFlist_each))
  }
  
  final_recommend_word2vec[i,]<-csim_name[order(scale_pro^2+((csim*10**3)^2))[1:3]]
  #êµ¬í•œ ì ìˆ˜ì¤‘ ìƒìœ„ 3ê°œì˜ ë¬¼ê±´ì„ ëŒ€ì…í•˜ì—¬ ì¶”ì²œë¦¬ìŠ¤íŠ¸ë¥¼ ì™„ì„±í•©ë‹ˆë‹¤.
}

rownames(final_recommend_word2vec)<-index #ê³ ê°ë²ˆí˜¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

save(final_recommend_word2vec,file="final_recommend_word2vec.Rdata")


################################################################################
################################################################################

##### í•™ìŠµí•œ Word2Vec ì‹œê°í™” #####

#3ì°¨ì›ìœ¼ë¡œ í•™ìŠµí•œ word2Vecì„ 3ì°¨ì›plotìœ¼ë¡œ í™•ì¸í•´ë³´ëŠ” ì‘ì—…ì„ í•˜ê¸°ìœ„í•´ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
install.packages("rgl")
library(rgl)

model3 = train_word2vec("Word2Vec.txt",output="Word2Vec3.bin",threads = 3,vectors = 3,window=8)
#3ì°¨ì›ìœ¼ë¡œ í•™ìŠµì„ ì‹œí‚µë‹ˆë‹¤.
# model3<-read.vectors("Word2Vec3.bin") #í•œë²ˆ ë§Œë“  ëª¨ë¸ì€ read.vectors í•¨ìˆ˜ë¡œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

install.packages("stringr")
library(stringr) #ì†Œë¶„ë¥˜ì½”ë“œì— A B C D ê°€ ë“¤ì–´ê°€ë©´ ë‹¤ë¥¸ìƒ‰ì„ ì£¼ê¸° ìœ„í•´ stringr íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

A<-str_detect(rownames(model3@.Data),"A")
B<-str_detect(rownames(model3@.Data),"B")
C<-str_detect(rownames(model3@.Data),"C")
D<-str_detect(rownames(model3@.Data),"D")

data_df<-cbind(model3@.Data[,1:3],0) #ìƒ‰ì„ ë„£ì„ ë¹ˆ ê³µê°„ì„ ë§Œë“­ë‹ˆë‹¤.
data_df[A,4]<-"red"             #Aì‚¬ëŠ” red
data_df[B,4]<-"darkgoldenrod1"  #Bì‚¬ëŠ” darkgoldenrod1
data_df[C,4]<-"deepskyblue"     #Cì‚¬ëŠ” deepskyblue
data_df[D,4]<-"darkviolet"      #Dì‚¬ëŠ” darkviolet
data_df[1,4]<-1                 #ê³µë°±ë¬¸ìëŠ” ê²€ì€ìƒ‰ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
plot3d(data_df,xlab="Xì¶•",ylab="Yì¶•",zlab="Zì¶•",col=data_df[,4],box=F)
